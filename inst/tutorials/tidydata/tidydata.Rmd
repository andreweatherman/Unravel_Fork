---
title: "Tidy Data"
output:
  learnr::tutorial:
    progressive: true
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(reticulate)
library(learnr)
library(daff)
library(magrittr)
library(dplyr)
library(readr)
# install knitr hooks
source(here::here("R", "knitr-hooks.R"))
install_knitr_hooks()
# webapps dir
get_webapp <- function(name) here::here("shinyapps", paste0(name, ".Rmd"))
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
# colors for data diffing
modified <- "#a0a0ff"
green <- "#74ff74"
red <- "#ff7374"

library(reactable)

# TODO could we define a custom checker that defaults the gradethis in normal exercises
# but, for exercises that should generate custom feedback we give back a div block with our html element
# this would be nice for outputing a daff or pointblank dynamically for e.g.
# UPDATE: the custom exercise.checker is a clunky route bc feedback is always expecting a simple message text for the output; the easier route would be to do the same knitr chunk opt hook strategy as the pretty print for a given exercise. For example:

# ```{python ex-read_pew, exercise=TRUE, opts.label="pprint", table.checker=TRUE}
# pew
# ```

# ^ would invoke our custom checker in a knitr hook in order to do our own checking for the result + provide a custom output

```

## Introduction

```{r}
# file.exists(here::here("inst/tutorials/data_diff/data/pew.csv"))
pew <- readr::read_csv(here::here("inst/tutorials/data_diff/data/pew.csv"))
reactable(pew, bordered = TRUE, showPageSizeOptions = TRUE)
```


In this tutorial, we will go over a framework called "Tidy Data" by Hadley Wickham introduced in his tidy data [paper](http://vita.had.co.nz/papers/tidy-data.pdf) in the *Journal of Statistical Software*. What is *tidy data*? Tidy data is a framework that helps structure and shape your data to make it easier to analyze and visualize.

Tables or dataframes that are "tidy" meets the following criteria:

- Each row is an observation
- Each column is a variable
- Each type of observational unit forms a table

All data that don't meet the criteria are considered "messy". In the following lessons, we will go over how to tidy data using this framework in both Python and R.

Pre-requisite knowledge:

a. function and method calls
b. subsetting data
c. loops
d. list comprehensions

By the end of the tutorial, you will know how to reshape your data into a tidy format using the following data shaping operations:

1. Unpivot/melt/gather columns into rows
2. Pivot/cast/spread rows into columns
3. Normalize data by separating a dataframe into multiple tables
4. Assemble data from multiple parts

## Columns contain values, not variables.

In this lesson, we will use data on income and religion in the United States from the Pew Research Center to illustrate how to work with columns that contain values, rather than variables.

```{python pysetup}
import pandas as pd
import os
pew = pd.read_csv(f"{os.getcwd()}/data/pew.csv")
pew_long = pd.melt(pew, id_vars='religion')
# this line works in regular rmd context
# pew = pd.read_csv(f"{os.getcwd()}/inst/tutorials/tidydata/data/pew.csv")
```

I have already loaded up the data for you to a variable called `pew`. Run the exercise below to take a peek at the data:

```{python ex-read_pew, exercise=TRUE, opts.label="pprint"}
pew
```

<br>

Notice how the income variable is spread across columns. In other words, the  data is in "wide" form. It's not that this format is inherently bad. But, it makes analysis a bit more difficult. So, we're going to reshape the data into a "long" form such that we work with 3 variables instead:

- religion
- income
- count

### Enter melt

In pandas, there is a function that will help us reshape `pew` into a tidy data format. It takes a few parameters we care about:

- `id_vars` is either a list, tuple, or a numpy.ndarray that represents the variable that will remain as is.
- `value_vars` identifies columns you wish to "melt down" (or unpivot). By default, it will melt all the columns not specified by `id_vars`.
- `var_name` is a string for the new column name when the `value_vars` is melted down. By default, it will be named `variable`.
- `value_name` is a string for the new column name that represents the values for the `var_name`. By default, it will be named `value`.

Since we want to only retain `religion` column as is, it will serve as the only item for `id_vars`. Go ahead and run this code and examine the output:

```{python ex-melt_pew, exercise=TRUE, opts.label="pprint"}
pew_long = pd.melt(pew, id_vars='religion')
pew_long

```

<br>












