---
pagetitle: prototype
example:
  title: prototype
  runtime: repl
  mode:
    document: html
  initial:
    js: "var data = CodeMirror.fromTextArea($('#data')[0], {\n  mode: 'r',\n  readOnly:
      'nocursor',\n  styleActiveLine: false,\n  lineNumbers: false,\n  gutters: ['data_line'],\n
      \ firstLineNumber: 1\n});\ndata.setSize(null, 50);\n\nvar group_by_verb_editor
      = CodeMirror.fromTextArea($('#group_by_verb')[0], {\n  mode: 'r',\n  readOnly:
      'nocursor',\n  styleActiveLine: false,\n  lineNumbers: false,\n  gutters: ['verb1_line'],\n
      \ firstLineNumber: 1\n});\ngroup_by_verb_editor.setSize(null, 50);\ngroup_by_verb_editor_wrapper
      = group_by_verb_editor.getWrapperElement();\ngroup_by_glyph = $(\".group_by_glyph\")[0]\ngroup_by_summary_box
      = $(\".group_by_summary_box\")[0]\ngroup_by_summary_box_row = $(\".group_by_summary_box_row\")[0]\ngroup_by_summary_box_col
      = $(\".group_by_summary_box_col\")[0]\n\ngroup_by_tippy = tippy(group_by_summary_box,
      {\n  theme: 'light',\n  allowHTML: true,\n  placement: 'bottom',\n  interactive:
      true,\n  delay: [50, 50],\n  trigger: 'click'\n  /*   triggerTarget: group_by_verb_editor_wrapper
      */\n});\n/* group_by_tippy.disable(); */\ngroup_by_tippy.setContent(\"<strong>Summary</strong>:
      <code class='code'>group_by</code> has no visible change, but we have internally
      grouped the dataframe by <span class='internal-change'>year</span>, and <span
      class='internal-change'>sex</span>. Now we can apply operations on these groups
      using functions like <code class='code'>summarise</code>.\");\n\n/* .addEventListener(\"onclick\",
      touchHandler, true); */\n/* \n $(document).ready(function () {\n   group_by_summary_box.addEventListener(\"click\",
      function() { \n     console.log(\"click\"); \n    group_by_tippy.enable()\n
      \   group_by_tippy.show();\n   });\n   group_by_summary_box.addEventListener(\"onMouseOut\",
      function() { \n     console.log(\"mouse out\"); \n    group_by_tippy.hide();\n
      \   group_by_tippy.disable();\n   });\n }); */\n\nvar summarise_verb_editor
      = CodeMirror.fromTextArea($('#summarise_verb')[0], {\n  mode: 'r',\n  readOnly:
      'nocursor',\n  styleActiveLine: false,\n  lineNumbers: false,\n  gutters: ['summarise_verb_editor_line'],\n
      \ firstLineNumber: 3\n});\nsummarise_verb_editor.setSize(null, 50);\nsummarise_verb_editor_wrapper
      = summarise_verb_editor.getWrapperElement();\nsummarise_glyph = $(\".summarise_glyph\")[0]\nsummarise_summary_box
      = $(\".summarise_summary_box\")[0]\nsummarise_summary_box_row = $(\".summarise_summary_box_row\")[0]\nsummarise_summary_box_col
      = $(\".summarise_summary_box_col\")[0]\n\nsummarise_tippy = tippy(summarise_summary_box,
      {\n  theme: 'light',\n  allowHTML: true,\n  placement: 'bottom',\n  interactive:
      true,\n  delay: [50, 50],\n  trigger: 'click'\n  /*   triggerTarget: summarise_summary_box
      */\n});\n/* group_by_tippy.disable(); */\nsummarise_tippy.setContent(\"<strong>Summary</strong>:
      <code class='code'>summarise</code> changed the dataframe's shape from <span
      class='number'>[1.9M x 5]</span> to <span class='visible-change number'>[276
      x 3]</span>. It calculated the total count for column <code class='code'>n</code>
      for (<code class='code'>year</code>, <code class='code'>sex</code>) groups using
      <code class='code'>sum</code>, which resulted in <span class='visible-change
      number'>276</span> unique rows. It created a new column <span class='visible-change'>total</span>,
      kept the <code class='code'>year</code> and <code class='code'>sex</code> columns,
      and dropped the <code class='code'>name</code>, <code class='code'>n</code>,
      and <code class='code'>prop</code> columns.\");\n\nvar pivot_wider_verb_editor
      = CodeMirror.fromTextArea($('#pivot_wider_verb')[0], {\n  mode: 'r',\n  readOnly:
      'nocursor',\n  styleActiveLine: false,\n  lineNumbers: false,\n  gutters: ['pivot_wider_verb_editor_line'],\n
      \ firstLineNumber: 3,\n  modifiers: [{\n    name: 'offset',\n    options: {\n
      \     offset: [0, 8],\n    },\n  }, ]\n});\npivot_wider_verb_editor.setSize(null,
      50);\npivot_wider_verb_editor_wrapper = pivot_wider_verb_editor.getWrapperElement();\npivot_wider_glyph
      = $(\".pivot_wider_glyph\")[0]\npivot_wider_summary_box = $(\".pivot_wider_summary_box\")[0]\npivot_wider_summary_box_row
      = $(\".pivot_wider_summary_box_row\")[0]\npivot_wider_summary_box_col = $(\".pivot_wider_summary_box_col\")[0]\n\npivot_wider_tippy
      = tippy(pivot_wider_summary_box, {\n  theme: 'light',\n  allowHTML: true,\n
      \ placement: 'bottom',\n  interactive: true,\n  delay: [50, 50],\n  trigger:
      'click'\n});\npivot_wider_tippy.setContent(\"<strong>Summary</strong>: <code
      class='code'>pivot_wider</code> changed the dataframe's shape from <span class='number'>[276
      x 3]</span> to <span class='visible-change number'>[138 x 3]</span>. It pivoted
      the dataframe from a long form to a wide form by reorganizing columns (<code
      class='code'>sex</code>, <code class='code'>total</code>) into (<span class='visible-change'>F</span>,
      <span class='visible-change'>M</span>), where <span class='visible-change'>F</span>
      and <span class='visible-change'>M</span> columns hold the values from <code
      class='code'>total</code>.\");\n\nvar mutate_verb_editor = CodeMirror.fromTextArea($('#mutate_verb')[0],
      {\n  mode: 'r',\n  readOnly: 'nocursor',\n  styleActiveLine: false,\n  lineNumbers:
      false,\n  gutters: ['mutate_verb_editor_line'],\n  firstLineNumber: 4\n});\nmutate_verb_editor.setSize(null,
      50);\nmutate_verb_editor_wrapper = mutate_verb_editor.getWrapperElement()\nmutate_glyph
      = $(\".mutate_glyph\")[0]\nmutate_summary_box = $(\".mutate_summary_box\")[0]\nmutate_summary_box_row
      = $(\".mutate_summary_box_row\")[0]\nmutate_summary_box_col = $(\".mutate_summary_box_col\")[0]\n\nmutate_tippy
      = tippy(mutate_summary_box, {\n  theme: 'light',\n  allowHTML: true,\n  placement:
      'bottom',\n  interactive: true,\n  delay: [50, 50],\n  trigger: 'click'\n});\nmutate_tippy.setContent(\"<strong>Summary</strong>:
      <code class='code'>mutate</code> changed the dataframe's shape from <span class='number'>[276
      x 3]</span> to <span class='visible-change number'>[138 x 3]</span>. It inserted
      a new column <span class='visible-change'>ratio</span>, which was computed using
      columns <code class='code'>M</code>, and <code class='code'>F</code>.\");\n\nfunction
      makeMarker() {\n  const marker = document.createElement('span');\n  marker.className
      = 'glyphicon glyphicon-move';\n  marker.style.paddingLeft = '2px'\n  marker.style.paddingRight
      = '0px'\n  marker.style.color = 'grey';\n  marker.style.cursor = 'move';\n  marker.style.fontSize
      = '0.8em';\n  marker.style.color = '#2c3745';\n  marker.style.cursor = '-webkit-grabbing';\n
      \ marker.style.float = 'left'\n  return marker;\n}\n\n/* doc = data.getDoc()\nlh
      = doc.getLineHandle(0);\ndoc.setGutterMarker(lh, 'data_line', makeMarker());
      */\n\n/* doc = verb1.getDoc()\nlh = doc.getLineHandle(0);\ndoc.setGutterMarker(lh,
      'verb1_line', makeMarker()); */\n\n/* doc = verb2.getDoc()\nlh = doc.getLineHandle(0);\ndoc.setGutterMarker(lh,
      'verb2_line', makeMarker());  */\n\n/* Obviously you'd already have a list passed
      from R, which then allows us to dynamically create a Map */\nlet snippets =
      new Map();\nsnippets.set(\"0\", \"babynames %>%\");\nsnippets.set(\"1\", \"group_by(year,
      sex) %>%\");\nsnippets.set(\"2\", \"summarise(total = sum(n)) %>%\");\nsnippets.set(\"3\",
      \"pivot_wider(names_from = sex, values_from = total) %>%\");\nsnippets.set(\"4\",
      \"mutate(ratio = M / F)\");\n\ncurrent_snippets = new Map(snippets);\n/* console.log(Array.from(snippets));
      */\n\nsortable = Sortable.create(simpleList, {\n  /* options */\n  onUpdate:
      function( /**Event*/ evt) {\n    // same properties as onEnd\n    console.log(\"update\");\n
      \   verb_id = \"#\" + evt.item.id + \"_verb\";\n    console.log(verb_id);\n
      \   order = sortable.toArray();\n    new_snippets = order.map(o => [o, snippets.get(o)]);\n
      \  /*  order.forEach((value, index) => snippets.set(index, value)); */\n\n    \n
      \   console.log(\"old:\");\n    current_snippets.forEach(function(value, key)
      {\n      console.log(key + ' = ' + value);\n    })\n    \n    current_snippets
      = new Map(new_snippets);\n    console.log(\"new:\");\n    current_snippets.forEach(function(value,
      key) {\n      console.log(key + ' = ' + value);\n    })\n    \n    \n    //
      TODO update the line firstLineNumber for the particular verbs\n    // as needed
      according to the sorting index update\n\n\n    // TODO update the pipe %>% according
      to whether or not last line or not\n\n    /*     console.log(verb2.getValue());
      */\n    console.log(evt.oldIndex);\n    console.log(evt.newIndex);\n  }\n\n});\n\n\n\n//
      TODO update whether or not the line is \"dim\" if toggle is off\n\n$(function()
      {\n\n  $('#group_by_toggle').change(function() {\n    console.log('group_by_toggle:
      ' + $(this).prop('checked'));\n    if ($(this).prop('checked')) {\n      group_by_tippy.enable();\n
      \     group_by_verb_editor_wrapper.style.opacity = \"1\";\n      group_by_glyph.style.opacity
      = \"1\";\n      group_by_summary_box.style.opacity = \"1\";\n      group_by_summary_box_row.style.opacity
      = \"1\";\n      group_by_summary_box_col.style.opacity = \"1\";\n    } else
      {\n      group_by_tippy.disable();\n      group_by_verb_editor_wrapper.style.opacity
      = \"0.25\";\n      group_by_glyph.style.opacity = \"0.25\";\n      group_by_summary_box.style.opacity
      = \"0\";\n      group_by_summary_box_row.style.opacity = \"0\";\n      group_by_summary_box_col.style.opacity
      = \"0\";\n    }\n  })\n\n  $('#summarise_toggle').change(function() {\n    console.log('summarise_toggle:
      ' + $(this).prop('checked'));\n    if ($(this).prop('checked')) {\n      summarise_tippy.enable();\n
      \     summarise_verb_editor_wrapper.style.opacity = \"1\";\n      summarise_glyph.style.opacity
      = \"1\";\n      summarise_summary_box.style.opacity = \"1\";\n      summarise_summary_box_row.style.opacity
      = \"1\";\n      summarise_summary_box_col.style.opacity = \"1\";\n    } else
      {\n      summarise_tippy.disable();\n      summarise_verb_editor_wrapper.style.opacity
      = \"0.25\";\n      summarise_glyph.style.opacity = \"0.25\";\n      summarise_summary_box.style.opacity
      = \"0\";\n      summarise_summary_box_row.style.opacity = \"0\";\n      summarise_summary_box_col.style.opacity
      = \"0\";\n    }\n  })\n\n  $('#pivot_wider_toggle').change(function() {\n    console.log('pivot_wider_toggle:
      ' + $(this).prop('checked'));\n    if ($(this).prop('checked')) {\n      pivot_wider_tippy.enable();\n
      \     pivot_wider_verb_editor_wrapper.style.opacity = \"1\";\n      pivot_wider_glyph.style.opacity
      = \"1\";\n      pivot_wider_summary_box.style.opacity = \"1\";\n      pivot_wider_summary_box_row.style.opacity
      = \"1\";\n      pivot_wider_summary_box_col.style.opacity = \"1\";\n    } else
      {\n      pivot_wider_tippy.disable();\n      pivot_wider_verb_editor_wrapper.style.opacity
      = \"0.25\";\n      pivot_wider_glyph.style.opacity = \"0.25\";\n      pivot_wider_summary_box.style.opacity
      = \"0\";\n      pivot_wider_summary_box_row.style.opacity = \"0\";\n      pivot_wider_summary_box_col.style.opacity
      = \"0\";\n    }\n  })\n\n  $('#mutate_toggle').change(function() {\n    console.log('mutate_toggle:
      ' + $(this).prop('checked'));\n\n    if ($(this).prop('checked')) {\n      mutate_tippy.enable();\n
      \     mutate_verb_editor_wrapper.style.opacity = \"1\";\n      mutate_glyph.style.opacity
      = \"1\";\n      mutate_summary_box.style.opacity = \"1\";\n      mutate_summary_box_row.style.opacity
      = \"1\";\n      mutate_summary_box_col.style.opacity = \"1\";\n    } else {\n
      \     mutate_tippy.disable();\n      mutate_verb_editor_wrapper.style.opacity
      = \"0.25\";\n      mutate_glyph.style.opacity = \"0.25\";\n      mutate_summary_box.style.opacity
      = \"0\";\n      mutate_summary_box_row.style.opacity = \"0\";\n      mutate_summary_box_col.style.opacity
      = \"0\";\n    }\n  })\n})\n"
    css: ".internal-change {\n  background: #a2d2e1;\n  border-radius: 0.5rem;\n  padding:
      0.1em;\n}\n\n.visible-change {\n  background: #ffefc7;\n  border-radius: 0.5rem;\n
      \ padding: 0.1em;\n}\n\n.blue-square {\n  border: 1px dashed black;\n  width:
      2em;\n  height: 2em;\n  background-color: lightblue;\n}\n\n.blue-square:hover{\n
      \ cursor:pointer\n}\n\n.grey-square {\n  border: 1px solid black;\n  width:
      2em;\n  height: 2em;\n  background-color: grey;\n}\n\n.yellow-square {\n  border:
      1px dashed black;\n  width: 2em;\n  height: 2em;\n  background-color: #fff1ce;\n}\n\n.yellow-square:hover{\n
      \ cursor:pointer\n}\n\n.empty-square {\n  width: 3em;\n  height: 2em;\n  /*
      padding-top: 90%; */\n}\n\n.editor-square {\n  width: 60em;\n  height: 1em;\n
      \ padding: 0px;\n  margin: 0px;\n  /* padding-top: 90%; */\n}\n\n\n.glyphicon-move
      {\n  font-size: 1em;\n  color: #2c3745;\n  cursor: -webkit-grabbing;\n  margin-top:
      0.5em;\n  padding-left: 0.5em;\n} \n\n.list-group {\n  width: auto;\n  display:
      flex;\n  justify-content: center;\n}\n\n.list-group-item {\n  width: 100%;\n
      \ height: auto;\n  border: 1px solid #eee;\n  padding: 2px;\n  margin: 2px;\n
      \ display: flex;\n  /* align-items: center; */\n}\n\n.list-group-item .disabled
      {\n  width: 80%;\n  height: 10px;\n  opacity: 0;\n  border: 1px solid #eee;\n
      \ padding: 2px;\n  margin: 2px;\n  display: flex;\n  align-items: center;\n
      \ \n}\n\n.CodeMirror {\n  background: red;\n  border: 1px solid #eee;\n  height:
      auto;\n  width: 100%;\n  margin: 0px;\n  padding-top: 10px;\n  /* float: right;
      */\n}\n\n.CodeMirror-gutters {\n  opacity: 0;\n  border-right: 1px solid #ddd;\n
      \ background-color: #f7f7f7;\n  white-space: wrap;\n}\n\n.summary {\n  padding:
      1em;\n}\n\n.fast .toggle-group { transition: left 0.2s; -webkit-transition:
      left 0.1s; }\n\n.toggle.ios, .toggle-on.ios, .toggle-off.ios { \n  /* height:
      3px; */\n  margin: 0.1em; \n  padding: 0.1em; \n  border-radius: 20rem;\n}\n\n.toggle.ios
      .toggle-handle { \n  padding: 8px;\n  border-radius: 10rem; \n}\n\n/* .row {\n
      \ width:100%;\n  margin:0;\n  padding:0;\n  display:flex;\n} */\n\n#simpleList
      {\n  margin: 10px;\n}\n\n.code {\n  background: #eee;\n  color: black;\n}\n\n.tippy-box
      {\n  border-radius: 1.5rem;\n  margin: 1em;\n}\n\n.tippy-content {\n  padding:
      1em;\n}\n\n.number {\n  font-family: Tahoma;\n}\n"
  solution:
    js: "var data = CodeMirror.fromTextArea($('#data')[0], {\n  mode: 'r',\n  readOnly:
      'nocursor',\n  styleActiveLine: false,\n  lineNumbers: false,\n  gutters: ['data_line'],\n
      \ firstLineNumber: 1\n});\ndata.setSize(null, 50);\n\nvar group_by_verb_editor
      = CodeMirror.fromTextArea($('#group_by_verb')[0], {\n  mode: 'r',\n  readOnly:
      'nocursor',\n  styleActiveLine: false,\n  lineNumbers: false,\n  gutters: ['verb1_line'],\n
      \ firstLineNumber: 1\n});\ngroup_by_verb_editor.setSize(null, 50);\ngroup_by_verb_editor_wrapper
      = group_by_verb_editor.getWrapperElement();\ngroup_by_glyph = $(\".group_by_glyph\")[0]\ngroup_by_summary_box
      = $(\".group_by_summary_box\")[0]\ngroup_by_summary_box_row = $(\".group_by_summary_box_row\")[0]\ngroup_by_summary_box_col
      = $(\".group_by_summary_box_col\")[0]\n\ngroup_by_tippy = tippy(group_by_summary_box,
      {\n  theme: 'light',\n  allowHTML: true,\n  placement: 'bottom',\n  interactive:
      true,\n  delay: [50, 50],\n  trigger: 'click'\n  /*   triggerTarget: group_by_verb_editor_wrapper
      */\n});\n/* group_by_tippy.disable(); */\ngroup_by_tippy.setContent(\"<strong>Summary</strong>:
      <code class='code'>group_by</code> has no visible change, but we have internally
      grouped the dataframe by <span class='internal-change'>year</span>, and <span
      class='internal-change'>sex</span>. Now we can apply operations on these groups
      using functions like <code class='code'>summarise</code>.\");\n\n/* .addEventListener(\"onclick\",
      touchHandler, true); */\n/* \n $(document).ready(function () {\n   group_by_summary_box.addEventListener(\"click\",
      function() { \n     console.log(\"click\"); \n    group_by_tippy.enable()\n
      \   group_by_tippy.show();\n   });\n   group_by_summary_box.addEventListener(\"onMouseOut\",
      function() { \n     console.log(\"mouse out\"); \n    group_by_tippy.hide();\n
      \   group_by_tippy.disable();\n   });\n }); */\n\nvar summarise_verb_editor
      = CodeMirror.fromTextArea($('#summarise_verb')[0], {\n  mode: 'r',\n  readOnly:
      'nocursor',\n  styleActiveLine: false,\n  lineNumbers: false,\n  gutters: ['summarise_verb_editor_line'],\n
      \ firstLineNumber: 3\n});\nsummarise_verb_editor.setSize(null, 50);\nsummarise_verb_editor_wrapper
      = summarise_verb_editor.getWrapperElement();\nsummarise_glyph = $(\".summarise_glyph\")[0]\nsummarise_summary_box
      = $(\".summarise_summary_box\")[0]\nsummarise_summary_box_row = $(\".summarise_summary_box_row\")[0]\nsummarise_summary_box_col
      = $(\".summarise_summary_box_col\")[0]\n\nsummarise_tippy = tippy(summarise_summary_box,
      {\n  theme: 'light',\n  allowHTML: true,\n  placement: 'bottom',\n  interactive:
      true,\n  delay: [50, 50],\n  trigger: 'click'\n  /*   triggerTarget: summarise_summary_box
      */\n});\n/* group_by_tippy.disable(); */\nsummarise_tippy.setContent(\"<strong>Summary</strong>:
      <code class='code'>summarise</code> changed the dataframe's shape from <span
      class='number'>[1.9M x 5]</span> to <span class='visible-change number'>[276
      x 3]</span>. It calculated the total count for column <code class='code'>n</code>
      for (<code class='code'>year</code>, <code class='code'>sex</code>) groups using
      <code class='code'>sum</code>, which resulted in <span class='visible-change
      number'>276</span> unique rows. It created a new column <span class='visible-change'>total</span>,
      kept the <code class='code'>year</code> and <code class='code'>sex</code> columns,
      and dropped the <code class='code'>name</code>, <code class='code'>n</code>,
      and <code class='code'>prop</code> columns.\");\n\nvar pivot_wider_verb_editor
      = CodeMirror.fromTextArea($('#pivot_wider_verb')[0], {\n  mode: 'r',\n  readOnly:
      'nocursor',\n  styleActiveLine: false,\n  lineNumbers: false,\n  gutters: ['pivot_wider_verb_editor_line'],\n
      \ firstLineNumber: 3,\n  modifiers: [{\n    name: 'offset',\n    options: {\n
      \     offset: [0, 8],\n    },\n  }, ]\n});\npivot_wider_verb_editor.setSize(null,
      50);\npivot_wider_verb_editor_wrapper = pivot_wider_verb_editor.getWrapperElement();\npivot_wider_glyph
      = $(\".pivot_wider_glyph\")[0]\npivot_wider_summary_box = $(\".pivot_wider_summary_box\")[0]\npivot_wider_summary_box_row
      = $(\".pivot_wider_summary_box_row\")[0]\npivot_wider_summary_box_col = $(\".pivot_wider_summary_box_col\")[0]\n\npivot_wider_tippy
      = tippy(pivot_wider_summary_box, {\n  theme: 'light',\n  allowHTML: true,\n
      \ placement: 'bottom',\n  interactive: true,\n  delay: [50, 50],\n  trigger:
      'click'\n});\npivot_wider_tippy.setContent(\"<strong>Summary</strong>: <code
      class='code'>pivot_wider</code> changed the dataframe's shape from <span class='number'>[276
      x 3]</span> to <span class='visible-change number'>[138 x 3]</span>. It pivoted
      the dataframe from a long form to a wide form by reorganizing columns (<code
      class='code'>sex</code>, <code class='code'>total</code>) into (<span class='visible-change'>F</span>,
      <span class='visible-change'>M</span>), where <span class='visible-change'>F</span>
      and <span class='visible-change'>M</span> columns hold the values from <code
      class='code'>total</code>.\");\n\nvar mutate_verb_editor = CodeMirror.fromTextArea($('#mutate_verb')[0],
      {\n  mode: 'r',\n  readOnly: 'nocursor',\n  styleActiveLine: false,\n  lineNumbers:
      false,\n  gutters: ['mutate_verb_editor_line'],\n  firstLineNumber: 4\n});\nmutate_verb_editor.setSize(null,
      50);\nmutate_verb_editor_wrapper = mutate_verb_editor.getWrapperElement()\nmutate_glyph
      = $(\".mutate_glyph\")[0]\nmutate_summary_box = $(\".mutate_summary_box\")[0]\nmutate_summary_box_row
      = $(\".mutate_summary_box_row\")[0]\nmutate_summary_box_col = $(\".mutate_summary_box_col\")[0]\n\nmutate_tippy
      = tippy(mutate_summary_box, {\n  theme: 'light',\n  allowHTML: true,\n  placement:
      'bottom',\n  interactive: true,\n  delay: [50, 50],\n  trigger: 'click'\n});\nmutate_tippy.setContent(\"<strong>Summary</strong>:
      <code class='code'>mutate</code> changed the dataframe's shape from <span class='number'>[276
      x 3]</span> to <span class='visible-change number'>[138 x 3]</span>. It inserted
      a new column <span class='visible-change'>ratio</span>, which was computed using
      columns <code class='code'>M</code>, and <code class='code'>F</code>.\");\n\nfunction
      makeMarker() {\n  const marker = document.createElement('span');\n  marker.className
      = 'glyphicon glyphicon-move';\n  marker.style.paddingLeft = '2px'\n  marker.style.paddingRight
      = '0px'\n  marker.style.color = 'grey';\n  marker.style.cursor = 'move';\n  marker.style.fontSize
      = '0.8em';\n  marker.style.color = '#2c3745';\n  marker.style.cursor = '-webkit-grabbing';\n
      \ marker.style.float = 'left'\n  return marker;\n}\n\n/* doc = data.getDoc()\nlh
      = doc.getLineHandle(0);\ndoc.setGutterMarker(lh, 'data_line', makeMarker());
      */\n\n/* doc = verb1.getDoc()\nlh = doc.getLineHandle(0);\ndoc.setGutterMarker(lh,
      'verb1_line', makeMarker()); */\n\n/* doc = verb2.getDoc()\nlh = doc.getLineHandle(0);\ndoc.setGutterMarker(lh,
      'verb2_line', makeMarker());  */\n\n/* Obviously you'd already have a list passed
      from R, which then allows us to dynamically create a Map */\nlet snippets =
      new Map();\nsnippets.set(\"0\", \"babynames %>%\");\nsnippets.set(\"1\", \"group_by(year,
      sex) %>%\");\nsnippets.set(\"2\", \"summarise(total = sum(n)) %>%\");\nsnippets.set(\"3\",
      \"pivot_wider(names_from = sex, values_from = total) %>%\");\nsnippets.set(\"4\",
      \"mutate(ratio = M / F)\");\n\ncurrent_snippets = new Map(snippets);\n/* console.log(Array.from(snippets));
      */\n\nsortable = Sortable.create(simpleList, {\n  /* options */\n  onUpdate:
      function( /**Event*/ evt) {\n    // same properties as onEnd\n    console.log(\"update\");\n
      \   verb_id = \"#\" + evt.item.id + \"_verb\";\n    console.log(verb_id);\n
      \   order = sortable.toArray();\n    new_snippets = order.map(o => [o, snippets.get(o)]);\n
      \  /*  order.forEach((value, index) => snippets.set(index, value)); */\n\n    \n
      \   console.log(\"old:\");\n    current_snippets.forEach(function(value, key)
      {\n      console.log(key + ' = ' + value);\n    })\n    \n    current_snippets
      = new Map(new_snippets);\n    console.log(\"new:\");\n    current_snippets.forEach(function(value,
      key) {\n      console.log(key + ' = ' + value);\n    })\n    \n    \n    //
      TODO update the line firstLineNumber for the particular verbs\n    // as needed
      according to the sorting index update\n\n\n    // TODO update the pipe %>% according
      to whether or not last line or not\n\n    /*     console.log(verb2.getValue());
      */\n    console.log(evt.oldIndex);\n    console.log(evt.newIndex);\n  }\n\n});\n\n\n\n//
      TODO update whether or not the line is \"dim\" if toggle is off\n\n$(function()
      {\n\n  $('#group_by_toggle').change(function() {\n    console.log('group_by_toggle:
      ' + $(this).prop('checked'));\n    if ($(this).prop('checked')) {\n      group_by_tippy.enable();\n
      \     group_by_verb_editor_wrapper.style.opacity = \"1\";\n      group_by_glyph.style.opacity
      = \"1\";\n      group_by_summary_box.style.opacity = \"1\";\n      group_by_summary_box_row.style.opacity
      = \"1\";\n      group_by_summary_box_col.style.opacity = \"1\";\n    } else
      {\n      group_by_tippy.disable();\n      group_by_verb_editor_wrapper.style.opacity
      = \"0.25\";\n      group_by_glyph.style.opacity = \"0.25\";\n      group_by_summary_box.style.opacity
      = \"0\";\n      group_by_summary_box_row.style.opacity = \"0\";\n      group_by_summary_box_col.style.opacity
      = \"0\";\n    }\n  })\n\n  $('#summarise_toggle').change(function() {\n    console.log('summarise_toggle:
      ' + $(this).prop('checked'));\n    if ($(this).prop('checked')) {\n      summarise_tippy.enable();\n
      \     summarise_verb_editor_wrapper.style.opacity = \"1\";\n      summarise_glyph.style.opacity
      = \"1\";\n      summarise_summary_box.style.opacity = \"1\";\n      summarise_summary_box_row.style.opacity
      = \"1\";\n      summarise_summary_box_col.style.opacity = \"1\";\n    } else
      {\n      summarise_tippy.disable();\n      summarise_verb_editor_wrapper.style.opacity
      = \"0.25\";\n      summarise_glyph.style.opacity = \"0.25\";\n      summarise_summary_box.style.opacity
      = \"0\";\n      summarise_summary_box_row.style.opacity = \"0\";\n      summarise_summary_box_col.style.opacity
      = \"0\";\n    }\n  })\n\n  $('#pivot_wider_toggle').change(function() {\n    console.log('pivot_wider_toggle:
      ' + $(this).prop('checked'));\n    if ($(this).prop('checked')) {\n      pivot_wider_tippy.enable();\n
      \     pivot_wider_verb_editor_wrapper.style.opacity = \"1\";\n      pivot_wider_glyph.style.opacity
      = \"1\";\n      pivot_wider_summary_box.style.opacity = \"1\";\n      pivot_wider_summary_box_row.style.opacity
      = \"1\";\n      pivot_wider_summary_box_col.style.opacity = \"1\";\n    } else
      {\n      pivot_wider_tippy.disable();\n      pivot_wider_verb_editor_wrapper.style.opacity
      = \"0.25\";\n      pivot_wider_glyph.style.opacity = \"0.25\";\n      pivot_wider_summary_box.style.opacity
      = \"0\";\n      pivot_wider_summary_box_row.style.opacity = \"0\";\n      pivot_wider_summary_box_col.style.opacity
      = \"0\";\n    }\n  })\n\n  $('#mutate_toggle').change(function() {\n    console.log('mutate_toggle:
      ' + $(this).prop('checked'));\n\n    if ($(this).prop('checked')) {\n      mutate_tippy.enable();\n
      \     mutate_verb_editor_wrapper.style.opacity = \"1\";\n      mutate_glyph.style.opacity
      = \"1\";\n      mutate_summary_box.style.opacity = \"1\";\n      mutate_summary_box_row.style.opacity
      = \"1\";\n      mutate_summary_box_col.style.opacity = \"1\";\n    } else {\n
      \     mutate_tippy.disable();\n      mutate_verb_editor_wrapper.style.opacity
      = \"0.25\";\n      mutate_glyph.style.opacity = \"0.25\";\n      mutate_summary_box.style.opacity
      = \"0\";\n      mutate_summary_box_row.style.opacity = \"0\";\n      mutate_summary_box_col.style.opacity
      = \"0\";\n    }\n  })\n})\n"
    css: ".internal-change {\n  background: #a2d2e1;\n  border-radius: 0.5rem;\n  padding:
      0.1em;\n}\n\n.visible-change {\n  background: #ffefc7;\n  border-radius: 0.5rem;\n
      \ padding: 0.1em;\n}\n\n.blue-square {\n  border: 1px dashed black;\n  width:
      2em;\n  height: 2em;\n  background-color: lightblue;\n}\n\n.blue-square:hover{\n
      \ cursor:pointer\n}\n\n.grey-square {\n  border: 1px solid black;\n  width:
      2em;\n  height: 2em;\n  background-color: grey;\n}\n\n.yellow-square {\n  border:
      1px dashed black;\n  width: 2em;\n  height: 2em;\n  background-color: #fff1ce;\n}\n\n.yellow-square:hover{\n
      \ cursor:pointer\n}\n\n.empty-square {\n  width: 3em;\n  height: 2em;\n  /*
      padding-top: 90%; */\n}\n\n.editor-square {\n  width: 60em;\n  height: 1em;\n
      \ padding: 0px;\n  margin: 0px;\n  /* padding-top: 90%; */\n}\n\n\n.glyphicon-move
      {\n  font-size: 1em;\n  color: #2c3745;\n  cursor: -webkit-grabbing;\n  margin-top:
      0.5em;\n  padding-left: 0.5em;\n} \n\n.list-group {\n  width: auto;\n  display:
      flex;\n  justify-content: center;\n}\n\n.list-group-item {\n  width: 100%;\n
      \ height: auto;\n  border: 1px solid #eee;\n  padding: 2px;\n  margin: 2px;\n
      \ display: flex;\n  /* align-items: center; */\n}\n\n.list-group-item .disabled
      {\n  width: 80%;\n  height: 10px;\n  opacity: 0;\n  border: 1px solid #eee;\n
      \ padding: 2px;\n  margin: 2px;\n  display: flex;\n  align-items: center;\n
      \ \n}\n\n.CodeMirror {\n  background: red;\n  border: 1px solid #eee;\n  height:
      auto;\n  width: 100%;\n  margin: 0px;\n  padding-top: 10px;\n  /* float: right;
      */\n}\n\n.CodeMirror-gutters {\n  opacity: 0;\n  border-right: 1px solid #ddd;\n
      \ background-color: #f7f7f7;\n  white-space: wrap;\n}\n\n.summary {\n  padding:
      1em;\n}\n\n.fast .toggle-group { transition: left 0.2s; -webkit-transition:
      left 0.1s; }\n\n.toggle.ios, .toggle-on.ios, .toggle-off.ios { \n  /* height:
      3px; */\n  margin: 0.1em; \n  padding: 0.1em; \n  border-radius: 20rem;\n}\n\n.toggle.ios
      .toggle-handle { \n  padding: 8px;\n  border-radius: 10rem; \n}\n\n/* .row {\n
      \ width:100%;\n  margin:0;\n  padding:0;\n  display:flex;\n} */\n\n#simpleList
      {\n  margin: 10px;\n}\n\n.code {\n  background: #eee;\n  color: black;\n}\n\n.tippy-box
      {\n  border-radius: 1.5rem;\n  margin: 1em;\n}\n\n.tippy-content {\n  padding:
      1em;\n}\n\n.number {\n  font-family: Tahoma;\n}\n"
output:
  js4shiny::html_document_js4shiny:
    css: ~
    script:
      head: https://unpkg.com/jquery@3.4.1

---
<div><!--for pandoc-->
<!DOCTYPE html>
<html>

  <head>
    <meta name="description" content="Demo of using Sortable with some items disabled.">
    <meta charset="utf-8">
    <title>JS Bin</title>
  </head>

  <body>

    <!-- Latest compiled and minified CSS:-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" integrity="sha384-B0vP5xmATw1+K9KRQjQERJvTumQW0nPEzvF6L/Z6nronJ3oUOFUFpCjEUQouq2+l" crossorigin="anonymous">

    <!-- Toggle switch library for boostrap 4 -->
    <link href="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/css/bootstrap4-toggle.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/bootstrap4-toggle@3.6.1/js/bootstrap4-toggle.min.js"></script>

    <!--  Idk why but a combo of bootstrap 4 and 6 is nice looking; try sticking to one -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css" />

    <!-- CodeMirror -->
    <script src="https://codemirror.net/lib/codemirror.js"></script>
    <link rel="stylesheet" href="https://codemirror.net/lib/codemirror.css" />
    <script src="https://codemirror.net/mode/r/r.js"></script>

    <!-- Latest Sortable -->
    <script src="https://raw.githack.com/SortableJS/Sortable/master/Sortable.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery-sortablejs@latest/jquery-sortable.js"></script>

    <!-- fontawesome! -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.1/css/all.css" />
    
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light.css"/>
    <link rel="stylesheet" href="https://unpkg.com/tippy.js@6/themes/light-border.css"/>
    
    <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@10.5.0/styles/default.min.css">
<script src="https://unpkg.com/@highlightjs/cdn-assets@10.5.0/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script src="https://unpkg.com/@highlightjs/cdn-assets@10.5.0/languages/go.min.js"></script>


    <p class="summary">Here we take the <code class="language-golang">babynames</code> dataframe, and use <code>group_by</code> to group the data into year and sex. Then, we count the total names for each year and sex group, and create a new column <code>total</code>. Next, it's useful to reshape the data by the <code>sex</code> column such that we end up with <strong>M</strong> and <strong>F</strong> columns. This sets us up to compute a ratio of males to females for the last step.</p>

    <!-- Sortable list -->
    <div id="simpleList" class="list-group">

      <!-- Summary boxes -->

      <!-- Summary box 1 -->
      <div class="d-flex list-group-item disabled" data-id="0">

        <!-- Empty div for the row dimension -->
        <div class="justify-content-center align-self-baseline">
          <div>
            <div class="d-flex justify-content-center align-self-center">
              <div class="row" style="font-size:1em;">&nbsp;</div>
            </div>
            <div class="d-flex empty-square justify-content-center">
              <p class="align-self-center" style="font-size: 0.8em;">1.9M</p>
            </div>
          </div>
        </div>

        <!-- Div for column dimension + square -->
        <div class="justify-content-center align-self-baseline">
          <div>
            <div class="d-flex justify-content-center align-self-center">
              <div class="row" style="font-size: 0.8em;">5</div>
            </div>
            <div class="d-flex grey-square justify-content-center align-self-center"></div>
          </div>
        </div>

        <!-- Div for column dimension + square -->
         <!-- <div class="justify-content-center align-self-baseline">
            <div class="d-flex justify-content-center align-self-center">
              <div class="row" style="font-size: 0.8em;">&nbsp;</div>
            </div>
            
                 </div> -->
        <div class="d-flex justify-content-center align-self-center">
          <span class="glyphicon glyphicon-move" aria-hidden="true" style="opacity:0;"></span>
        </div>

        <div class="d-flex justify-content-center align-self-center"  style="padding:0.5em;">
          <div class="row" style="font-size: 0.8em;">&nbsp;</div>
        </div>
        <textarea class="verb" id="data" style="opacity: 0;">babynames %>%</textarea>

        <div class="col-xs" style="opacity:0; padding-left:0.5em;">
          <div class="d-flex justify-content-center align-self-center">
            <div class="row" style="font-size: 0.8em;">&nbsp;</div>
          </div>
          <input type="checkbox" checked data-toggle="toggle" data-size="xs" data-height="20" data-width="30" data-on=" " data-off=" " data-style="ios fast" data-onstyle="success" data-offstyle="secondary">
        </div>

      </div>


      <!-- Summary box 2 -->
      <div class="d-flex list-group-item" id="group_by" data-id="1">


        <!-- Empty div for the row dimension -->
        <div class="justify-content-center align-self-baseline">
          <div class="d-flex justify-content-center align-self-center">
            <div class="row" style="font-size:1em;">&nbsp;</div>
          </div>
          <div class="group_by_summary_box_row d-flex empty-square justify-content-center">
            <p class="align-self-center" style="font-size: 0.8em;">1.9M</p>
          </div>
        </div>

        <!-- Div for column dimension + square -->
        <div class="justify-content-center align-self-baseline">
          <div class="group_by_summary_box_col d-flex justify-content-center align-self-center">
            <div class="row" style="font-size: 0.8em;">5</div>
          </div>
          <div class="group_by_summary_box d-flex blue-square justify-content-center align-self-center"></div>
        </div>

        <!-- Div for glyphicon -->
        <div class="group_by_glyph d-flex justify-content-center align-self-center">
          <span class="glyphicon glyphicon-move" aria-hidden="true"></span>
        </div>

          <div class="d-flex justify-content-center align-self-center " style="padding:0.5em;">
            <div class="row" style="font-size: 0.25em;">&nbsp;</div>
          </div>
          <textarea class="verb" id="group_by_verb">&#9;group_by(year, sex) %>%</textarea>

        <!-- Toggle -->
        <div class="col-xs" style="padding-left:0.5em;">
          <div class="d-flex justify-content-center align-self-center">
            <div class="row" style="font-size: 1em;">&nbsp;</div>
          </div>
          <input id = "group_by_toggle" type="checkbox" checked data-toggle="toggle" data-size="xs" data-height="20" data-width="30" data-on=" " data-off=" " data-style="ios fast" data-onstyle="success" data-offstyle="secondary">
        </div>

      </div>

      <!-- Summary box 3 -->
      <div class="d-flex list-group-item" id="summarise" data-id="2">

        <!-- Empty div for the row dimension -->
        <div class="justify-content-center align-self-baseline " style="background:white;">
          <div class="d-flex justify-content-center align-self-center" style="background:white;">
            <div class="row" style="font-size:1em;">&nbsp;</div>
          </div>
          <div class="summarise_summary_box_row d-flex empty-square justify-content-center">
            <p class="align-self-center" style="font-size: 0.8em;">276</p>
          </div>
        </div>

        <!-- Div for column dimension + square -->
        <div class="justify-content-center align-self-baseline">
          <div class="summarise_summary_box_col d-flex justify-content-center align-self-center">
            <div class="row" style="font-size: 0.8em;">3</div>
          </div>
          <div class="summarise_summary_box d-flex yellow-square justify-content-center align-self-center"></div>
        </div>

        <div class="d-flex justify-content-center align-self-center" style="background:white;">
          <span class="summarise_glyph glyphicon glyphicon-move" aria-hidden="true"></span>
        </div>

        <div class="d-flex justify-content-center align-self-center" style="padding:0.5em;">
          <div class="row" style="font-size: 0.25em;">&nbsp;</div>
        </div>
        <textarea class="verb" id="summarise_verb">&#9;summarise(total = sum(n)) %>%</textarea>

<!-- Toggle -->
        <div class="col-xs" style="padding-left:0.5em;">
          <div class="d-flex justify-content-center align-self-center">
            <div class="p-0" style="font-size: 1em;">&nbsp;</div>
          </div>
          <input id="summarise_toggle" type="checkbox" checked data-toggle="toggle" data-size="xs" data-height="20" data-width="30" data-on=" " data-off=" " data-style="ios fast" data-onstyle="success" data-offstyle="secondary">
        </div>

      </div>

      <!-- Summary box 4 -->
      <div class="d-flex list-group-item" id="pivot_wider" data-id="3">

        <!-- Empty div for the row dimension -->
        <div class="justify-content-center align-self-baseline">
          <div class="d-flex justify-content-center align-self-center" style="background:white;">
            <div class="row" style="font-size:1em;">&nbsp;</div>
          </div>
          <div class="pivot_wider_summary_box_row d-flex empty-square justify-content-center">
            <p class="align-self-center" style="font-size: 0.8em;">138</p>
          </div>
        </div>

        <!-- Div for column dimension + square -->
        <div class="justify-content-center align-self-baseline">
          <div class="pivot_wider_summary_box_col d-flex justify-content-center align-self-center">
            <div class="row" style="font-size: 0.8em;">3</div>
          </div>
          <div class="pivot_wider_summary_box d-flex yellow-square justify-content-center align-self-center"></div>
        </div>

        <!-- Div for glyphicon -->
        <div class="d-flex justify-content-center align-self-center">
          <span class="pivot_wider_glyph glyphicon glyphicon-move" aria-hidden="true"></span>
        </div>

        <!-- Div for column dimension + square -->
        <div class="d-flex justify-content-center align-self-center"  style="padding:0.5em;">
          <div class="p-0" style="font-size: 0.25em;">&nbsp;</div>
        </div>
        <textarea class="verb" id="pivot_wider_verb">&#9;pivot_wider(names_from = sex, values_from = total) %>%</textarea>

        <!-- Toggle -->
        <div class="col-xs" style="padding-left:0.5em;">
          <div class="p-0" style="font-size: 1em;">&nbsp;</div>
          <input id="pivot_wider_toggle" type="checkbox" checked data-toggle="toggle" data-size="xs" data-height="20" data-width="30" data-on=" " data-off=" " data-style="ios fast" data-onstyle="success" data-offstyle="secondary">
        </div>

      </div>

      <!-- Summary box 4 -->
      <div class="d-flex list-group-item" id="mutate" data-id="4">

        <!-- Empty div for the row dimension -->
        <div class="justify-content-center align-self-baseline">
          <div class="d-flex justify-content-center align-self-center">
            <div class="row" style="font-size:1em;">&nbsp;</div>
          </div>
          <div class="mutate_summary_box_row d-flex empty-square justify-content-center">
            <div class="row" style="font-size: 0.8em;">138</div>
          </div>
        </div>
        
        <!-- Div for column dimension + square -->
        <div class="justify-content-center align-self-baseline">
          <div class="mutate_summary_box_col d-flex justify-content-center align-self-center">
            <div class="row" style="font-size: 0.8em;">4</div>
          </div>
          <div class="mutate_summary_box d-flex yellow-square justify-content-center align-self-center"></div>
        </div>

        <!-- Div for glyphicon -->
        <div class="d-flex justify-content-center align-self-center">
          <span class="mutate_glyph glyphicon glyphicon-move" aria-hidden="true"></span>
        </div>

        <!-- Div for verb -->
        <div class="d-flex justify-content-center align-self-center" style="padding:0.5em;">
          <div class="row" style="font-size: 0.25em;">&nbsp;</div>
        </div>
        <textarea class="verb" id="mutate_verb">&#9;mutate(ratio = M / F)</textarea>
          
        <!-- Toggle -->
        <div class="col-xs" style="padding-left:0.5em;">
          <div class="p-0" style="font-size: 1em;">&nbsp;</div>
          <input id="mutate_toggle" type="checkbox" checked data-toggle="toggle" data-size="xs" data-height="20" data-width="30" data-on=" " data-off=" " data-style="ios fast" data-onstyle="success" data-offstyle="secondary">
        </div>

      </div>

    </div>

    <!-- TODO: add a data change scheme row with color key -->

  </body>

</html>

</div><!--for pandoc-->